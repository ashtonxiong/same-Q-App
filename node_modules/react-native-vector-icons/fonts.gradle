/**
<<<<<<< HEAD
 * Register font asset source folder
 */
android.sourceSets.main.assets.srcDirs += file("$buildDir/intermediates/ReactNativeVectorIcons")

/**
 * Task to copy icon font files
 */
afterEvaluate {
    def config = project.hasProperty("vectoricons") ? project.vectoricons : [];
    def iconFontsDir = config.iconFontsDir ?: "../../node_modules/react-native-vector-icons/Fonts";
    def iconFontNames = config.iconFontNames ?: [ "*.ttf" ];

    def fontCopyTask = tasks.create(
        name: "copyReactNativeVectorIconFonts",
        type: Copy) {
        description = "copy vector icon fonts."
        into "$buildDir/intermediates/ReactNativeVectorIcons/fonts"

        iconFontNames.each { fontName ->
            from(iconFontsDir) {
                include(fontName)
            }
        }
    }

    android.applicationVariants.all { def variant ->
        def targetName = variant.name.capitalize()

        def generateAssetsTask = tasks.findByName("generate${targetName}Assets")
        generateAssetsTask.dependsOn(fontCopyTask)

        def lintVitalAnalyzeTask = tasks.findByName("lintVitalAnalyze${targetName}")
        lintVitalAnalyzeTask?.dependsOn(fontCopyTask)
    }
=======
 * Task to copy icon font files
 */

def config = project.hasProperty("vectoricons") ? project.vectoricons : [];

def iconFontsDir = config.iconFontsDir ?: "../../node_modules/react-native-vector-icons/Fonts";
def iconFontNames = config.iconFontNames ?: [ "*.ttf" ];

gradle.projectsEvaluated {
    android.applicationVariants.all { def variant ->
        def targetName = variant.name.capitalize()
        def targetPath = variant.dirName

        // Create task for copying fonts
        def currentFontTask = tasks.create(
                name: "copy${targetName}IconFonts",
                type: Copy) {
            into("${buildDir}/intermediates")

            iconFontNames.each { fontName ->

              from(iconFontsDir) {
                include(fontName)
                into("assets/${targetPath}/fonts/")
              }

              // Workaround for Android Gradle Plugin 3.2+ new asset directory
              from(iconFontsDir) {
                include(fontName)
                into("merged_assets/${variant.name}/merge${targetName}Assets/out/fonts/")
              }

              // Workaround for Android Gradle Plugin 3.4+ new asset directory
              from(iconFontsDir) {
                include(fontName)
                into("merged_assets/${variant.name}/out/fonts/")
              }
            }
        }

        currentFontTask.dependsOn("merge${targetName}Resources")
        currentFontTask.dependsOn("merge${targetName}Assets")

        [
            "processArmeabi-v7a${targetName}Resources",
            "processX86${targetName}Resources",
            "processUniversal${targetName}Resources",
            "process${targetName}Resources"
        ].each { name ->
            Task dependentTask = tasks.findByPath(name);

            if (dependentTask != null) {
                dependentTask.dependsOn(currentFontTask)
            }
        }
    }
>>>>>>> 5b2c4effd1bf3fccca5e7c14270419348d8a8566
}
